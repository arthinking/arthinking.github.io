<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Page 7 | arthinking | ChinSyun Pang&#39;s blog</title>
  <meta name="author" content="arthinking">
  
  <meta name="description" content="Struggle for HighPay zoom.">
  
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  
  <meta property="og:site_name" content="arthinking"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="arthinking" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div id="page" class="site">
  <div id="primary" class="content-area">

    <header id="header" class="inner"><div class="site-branding">
  <h1 class="site-title">
    <a href="/">arthinking</a>
  </h1>
  <p class="site-description">ChinSyun Pang&#39;s blog</p>
</div>
<nav id="site-navigation" class="main-navigation" role="navigation">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
</nav></header>

    <article id="content" class="site-content">
      <main id="main" class="site-main posts-loop" role="main">
        
  <article class="post article">

  
  
    <h3 class="article-title"><a href="/log/Log4J系能/"><span>日志框架性能比较</span></a></h3>
  


  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/log/Log4J系能/" rel="bookmark">
        <time class="entry-date published" datetime="2016-02-02T06:33:13.000Z">
          2016-02-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <blockquote>
<p>Author: ChinSyun Pang<br>Weibo: <a href="http://weibo.com/arthinkingplus" target="_blank" rel="external">arthinking_plus</a><br>Posted in: <a href="http://www.itzhai.com" target="_blank" rel="external">http://www.itzhai.com</a></p>
</blockquote>
<p>#性能问题</p>
<p>关于Log4j的性能问题，可以先阅读以下官方文档的一点说明：<a href="http://logging.apache.org/log4j/1.2/manual.html" title="Performance" target="_blank" rel="external">Performance</a></p>
<p><a href="http://www.reader8.cn/jiaocheng/20130810/2235056.html" title="Log4J 2" target="_blank" rel="external">Log4J 2</a></p>
<p>在<a href="http://www.infoq.com/cn/news/2014/08/apache-log4j2" title="Apache Log4j 2.0值得升级吗" target="_blank" rel="external">Apache Log4j 2.0值得升级吗</a>这篇文章中阐述了Log4j 2.0的高性能。而<a href="http://www.infoq.com/cn/news/2014/07/apache-log4j2.0-publish" title="Log4j 2.0" target="_blank" rel="external">Log4j 2.0</a>的API是和Log4j 1.x系列的API不兼容的</p>
<p>在一个项目中如果需要在不同的模块设置不同的日志级别，并且输出到不同的日志文件中，可以这样设置不同的logger：</p>
<blockquote>
<p><a href="http://www.theserverside.com/news/thread.tss?thread_id=31659" target="_blank" rel="external">http://www.theserverside.com/news/thread.tss?thread_id=31659</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
        <div class="article-meta pull-left">
          
  

  <span class="post-categories">
    <i class="icon-categories"></i>
    <a href="/categories/日志/">日志</a>
  </span>


          
  

  <span class="post-tags">
    <i class="icon-tags"></i>
    <a href="/tags/Log4J/">Log4J</a>
  </span>


        </div>
        
    </footer>
  </div>
</article>



  <article class="post article">

  
  
    <h3 class="article-title"><a href="/javascript/main/"><span></span></a></h3>
  


  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/javascript/main/" rel="bookmark">
        <time class="entry-date published" datetime="2016-02-02T06:33:13.000Z">
          2016-02-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        console.log('This would be the main JS file.');

      
    </div>
    <footer class="article-footer">
        <div class="article-meta pull-left">
          
          
        </div>
        
    </footer>
  </div>
</article>



  <article class="post article">

  
  
    <h3 class="article-title"><a href="/document/20150210_API文档编辑工具/"><span>API文档编辑工具</span></a></h3>
  


  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/document/20150210_API文档编辑工具/" rel="bookmark">
        <time class="entry-date published" datetime="2016-02-02T06:33:13.000Z">
          2016-02-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <blockquote>
<p>Author: ChinSyun Pang<br>Weibo: <a href="http://weibo.com/arthinkingplus" target="_blank" rel="external">arthinking_plus</a><br>Posted in: <a href="http://www.itzhai.com" target="_blank" rel="external">http://www.itzhai.com</a></p>
<p><a href="http://turnapi.com/" target="_blank" rel="external">http://turnapi.com/</a><br>这是基于一款markdown语法的文档生成器，没有提供实体和返回值的统一管理。</p>
<p><a href="http://symfony.com/doc/current/components/yaml/yaml_format.html" target="_blank" rel="external">http://symfony.com/doc/current/components/yaml/yaml_format.html</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
        <div class="article-meta pull-left">
          
  

  <span class="post-categories">
    <i class="icon-categories"></i>
    <a href="/categories/工具/">工具</a>
  </span>


          
  

  <span class="post-tags">
    <i class="icon-tags"></i>
    <a href="/tags/API/">API</a>
  </span>


        </div>
        
    </footer>
  </div>
</article>



  <article class="post article">

  
  
    <h3 class="article-title"><a href="/design-pattern/给一个多处使用到的类中的某些方法添加额外的处理动作/"><span>给一个多处使用到的类中的某些方法添加额外的处理动作</span></a></h3>
  


  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/design-pattern/给一个多处使用到的类中的某些方法添加额外的处理动作/" rel="bookmark">
        <time class="entry-date published" datetime="2016-02-02T06:33:13.000Z">
          2016-02-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <blockquote>
<p>Author: ChinSyun Pang<br>Weibo: <a href="http://weibo.com/arthinkingplus" target="_blank" rel="external">arthinking_plus</a><br>Posted in: <a href="http://www.itzhai.com" target="_blank" rel="external">http://www.itzhai.com</a></p>
</blockquote>
<p>现有如下程序：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Searcher</span> </span>&#123;</span><br><span class="line">	<span class="function">List&lt;String&gt; <span class="title">searchSong</span><span class="params">(<span class="keyword">int</span> songType)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LuceneSearcher</span> <span class="keyword">implements</span> <span class="title">Searcher</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">searchSong</span><span class="params">(<span class="keyword">int</span> songType)</span> </span>&#123;</span><br><span class="line">		List&lt;String&gt; result = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">		result.add(<span class="string">"Wings you are the hero"</span>);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyMain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		LuceneSearcher searcher = <span class="keyword">new</span> LuceneSearcher();</span><br><span class="line">		searcher.searchSong(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>LuceneSearcher在项目中的很多地方都用到了，现在想在LuceneSearcher的searchSong()方法添加一个处理逻辑，为了进行全局的改动，避免在多处地方分别改动，现在使用代理模式，创建一个Searcher的代理：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomSearcher</span> <span class="keyword">implements</span> <span class="title">Searcher</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Searcher searcher;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CustomSearcher</span><span class="params">(Searcher searcher)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.searcher = searcher;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">searchSong</span><span class="params">(<span class="keyword">int</span> songType)</span> </span>&#123;</span><br><span class="line">		List&lt;String&gt; result = searcher.searchSong(songType);</span><br><span class="line">		result.add(<span class="string">"big blue ocean"</span>);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这样就可以只在对象的声明创建语句改动下，程序中调用的地方就可以保持原样了：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyMain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		LuceneSearcher searcher = <span class="keyword">new</span> LuceneSearcher();</span><br><span class="line">		searcher.searchSong(<span class="number">1</span>);  <span class="comment">// 调用的语句保持原样</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果Searcher接口有其他的实现，也可以很方便的使用这个代理方法改写方法了。另外，如果确定需要为接口的所有方法都使用代理进行改写，可以使用动态代理实现，而且通过使用动态代理（<a href="http://www.itzhai.com/java-notes-reflection-dynamic-proxies.html#动态代理：" title="JDK动态代理" target="_blank" rel="external">JDK动态代理</a>也可以通过invoke方法判断当前是否想要改写的方法而进行处理，<a href="http://www.itzhai.com/java-dong-tai-dai-li-zhi-jdk-dong-tai-dai-li-he-cglib-dong-tai-dai-li-mian-xiang-qie-mian-bian-cheng-aop-yuan-li.html#CGLib动态代理" title="CGLib动态代理" target="_blank" rel="external">CGLib动态代理</a>]对应为intercept方法），可以通过写一个代理处理类，就同时可以代理其他的类了，使用起来更灵活。</p>
<p>如果LuceneSearcher并不是通过实现接口的方式编写的，那么我们可以继承这个LuceneSearcher接口，并覆盖searchSong方法加入处理逻辑，这样也通过改动创建语句就可以很方便的对代码进行了调整。</p>

      
    </div>
    <footer class="article-footer">
        <div class="article-meta pull-left">
          
  

  <span class="post-categories">
    <i class="icon-categories"></i>
    <a href="/categories/设计模式/">设计模式</a>
  </span>


          
        </div>
        
    </footer>
  </div>
</article>



  <article class="post article">

  
  
    <h3 class="article-title"><a href="/blog/20150131_2015年技术学习规划/"><span>2015年技术学习规划</span></a></h3>
  


  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/blog/20150131_2015年技术学习规划/" rel="bookmark">
        <time class="entry-date published" datetime="2016-02-02T06:33:13.000Z">
          2016-02-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <blockquote>
<p>Author: ChinSyun Pang<br>Weibo: <a href="http://weibo.com/arthinkingplus" target="_blank" rel="external">arthinking_plus</a><br>Posted in: <a href="http://www.itzhai.com" target="_blank" rel="external">http://www.itzhai.com</a></p>
</blockquote>
<p>##软件架构：</p>
<p>###设计模式 </p>
<ul>
<li>《head first 设计模式》</li>
<li>《设计模式之禅》</li>
<li>《Effective Java》</li>
</ul>
<p>###项目经验总结<br>总结项目中的技术，所做的内容和技术上的改进。</p>
<p>###框架源码解读<br>通过阅读优秀的开源框架，学习Java面向对象的设计原理。</p>
<p>##工作相关技术研究</p>
<p>###Nginx<br>Nginx使用   </p>
<ul>
<li>《深入理解Nginx : 模块开发与架构解析》</li>
</ul>
<p>###Jsoup<br>Jsoup源码解读    </p>
<p>###Spring<br>Spring源码解读    </p>
<p>###MySQL<br>MySQL架构与设计  </p>
<p>SQL语句优化    </p>
<p>###JDBC</p>
<p>数据库连接池实现</p>
<p>###Tomcat<br>Tomcat源码解析</p>
<p>##操作系统：</p>
<p>###Linux &amp; Unix</p>
<ul>
<li>《UNIX编程艺术》</li>
<li>《鸟哥的Linux私房菜》</li>
</ul>
<p>##网络</p>
<p>###HTTP</p>
<ul>
<li>《http权威指南》</li>
</ul>
<p>##数据库</p>
<p>###MySQL优化</p>
<ul>
<li>《高性能MySQL》</li>
</ul>
<p>##JVM</p>
<ul>
<li>《深入理解Java虚拟机》</li>
</ul>
<p>##数据结构与算法<br>尽量通过C语言学习或复习数据结构和算法知识，同时通过开源框架和Java源码学习数据结构与算法的运用，多对比现有开源框架的效率，思考改进的空间。</p>
<ul>
<li>《数据结构与算法分析》</li>
<li>《算法导论》</li>
<li>《算法引轮 – 一种创造性方法》</li>
<li></li>
</ul>
<p>###程序员基本修养</p>
<ul>
<li>《编程之美》</li>
<li>《编程珠玑》</li>
<li>《更多的编程珠玑》</li>
<li>《代码大全》</li>
<li>《Elements of Programming》</li>
<li>《C Interfaces and Implementations》</li>
<li>《writing efficient programs》</li>
</ul>

      
    </div>
    <footer class="article-footer">
        <div class="article-meta pull-left">
          
  

  <span class="post-categories">
    <i class="icon-categories"></i>
    <a href="/categories/杂谈/">杂谈</a>
  </span>


          
  

  <span class="post-tags">
    <i class="icon-tags"></i>
    <a href="/tags/Hexo/">Hexo</a>
  </span>


        </div>
        
    </footer>
  </div>
</article>



  <article class="post article">

  
  
    <h3 class="article-title"><a href="/Java/热部署/"><span>Resin中的热部署</span></a></h3>
  


  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/Java/热部署/" rel="bookmark">
        <time class="entry-date published" datetime="2016-02-02T06:33:13.000Z">
          2016-02-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <blockquote>
<p>Author: ChinSyun Pang<br>Weibo: <a href="http://weibo.com/arthinkingplus" target="_blank" rel="external">arthinking_plus</a><br>Posted in: <a href="http://www.itzhai.com" target="_blank" rel="external">http://www.itzhai.com</a></p>
</blockquote>
<p>###Resin中的热部署<br>在resin.conf中添加如下的JVM启动参数：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">jvm-arg</span>&gt;</span>-Xdebug<span class="tag">&lt;/<span class="name">jvm-arg</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>表示启动debug模式，当更新了类中的方法的时候，控制台会提示reloading class，这是通过JVM的HotSwap功能动态更新的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">... Reloading ...</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">由于JVM的HotSwap不支持新增属性，方法和类的修改，所以进行了这些操作之后，是无法实现热部署的，Resin会自动改用Hot deploy的方式进行应用更新。</span><br><span class="line"></span><br><span class="line">当去掉该启动参数的时候，修改一个类，控制台会提示如下的内容：</span><br></pre></td></tr></table></figure>
<p>… WebApp[…] stopping<br>… WebApp[…] active<br>```</p>
<p>###远程调试相关参数<br><a href="http://itindex.net/detail/46971-java-%E8%B0%83%E8%AF%95" title="Xdebug" target="_blank" rel="external">-Xdebug</a> -Xrunjdwp,transport=dt_socket,server=y,address=5432,suspend=n,onthrow=java.io.IOException,launch=/sbin/echo</p>

      
    </div>
    <footer class="article-footer">
        <div class="article-meta pull-left">
          
  

  <span class="post-categories">
    <i class="icon-categories"></i>
    <a href="/categories/Java/">Java</a>
  </span>


          
  

  <span class="post-tags">
    <i class="icon-tags"></i>
    <a href="/tags/热部署/">热部署</a>
  </span>


        </div>
        
    </footer>
  </div>
</article>



  <article class="post article">

  
  
    <h3 class="article-title"><a href="/Java/JDK配置与JVM监控/"><span>JDK配置与JVM监控</span></a></h3>
  


  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/Java/JDK配置与JVM监控/" rel="bookmark">
        <time class="entry-date published" datetime="2016-02-02T06:33:13.000Z">
          2016-02-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <blockquote>
<p>Author: ChinSyun Pang<br>Weibo: <a href="http://weibo.com/arthinkingplus" target="_blank" rel="external">arthinking_plus</a><br>Posted in: <a href="http://www.itzhai.com" target="_blank" rel="external">http://www.itzhai.com</a></p>
</blockquote>
<p>#安装JDK</p>
<blockquote>
<p><a href="http://jingyan.baidu.com/article/b0b63dbfd5db8b4a48307027.html" title="ubuntu 12.04 LTS 安装配置JDK" target="_blank" rel="external">ubuntu 12.04 LTS 安装配置JDK</a>    </p>
</blockquote>
<p>下载jdk-xxx.bin</p>
<p>解压文件<br>chmod u+x jdk-xxx.bin<br>./jdk-xxx.bin    </p>
<p>复制解压出jdk-xxx文件夹到/usr/lib下<br>sudo mkdir -p /usr/lib/jvm/<br>cp -r jdk-xxx /usr/lib/jvm/jdkxxx</p>
<p>#配置JDK</p>
<blockquote>
<p><a href="http://blog.chinaunix.net/uid-26404477-id-3471246.html" title="ubuntu 12.04安装jdk" target="_blank" rel="external">ubuntu 12.04安装jdk</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install gedit</span><br><span class="line">sudo gedit /etc/profile</span><br></pre></td></tr></table></figure>
<p>or<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/</span><br><span class="line">vim profile</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/lib/jvm/jdk1.7.0_10</span><br><span class="line">export JRE_HOME=/usr/lib/jvm/jdk1.7.0_10/jre </span><br><span class="line">export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JAVA_HOME/lib:$JRE_HOME/lib:$CLASSPATH</span><br><span class="line"></span><br><span class="line">export PATH=$JAVA_HOME/bin:$PATH</span><br></pre></td></tr></table></figure>
<p>关闭，保存，使用source更新一下profile文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.profile</span><br></pre></td></tr></table></figure></p>
<p>如果之前系统里面已经安装了openjdk，可以使用如下方法将默认jdk更改过来：</p>
<p>将系统默认的jdk修改过来<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo update-alternatives --install /usr/bin/java java /usr/lib/jvm/jdk1.7.0_10/bin/java 300</span><br></pre></td></tr></table></figure></p>
<p>输入sun jdk前的数字就好了    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo update-alternatives --install /usr/bin/javac javac /usr/lib/jvm/jdk1.7.0_10/bin/javac 300</span><br><span class="line">$ sudo update-alternatives --config java </span><br><span class="line">$ sudo update-alternatives --config javac</span><br></pre></td></tr></table></figure>
<p>#使用VisualVM监控远程主机JVM</p>
<blockquote>
<p><a href="http://www.blogjava.net/titanaly/archive/2012/03/20/372318.html" title="visualvm监控jvm及远程jvm监控方法" target="_blank" rel="external">visualvm监控jvm及远程jvm监控方法</a></p>
</blockquote>
<p>##直接使用JDK<br>如果是直接监控JVM，则在 <code>/etc/profile</code> 文件里面添加如下配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_OPTS="-Dcom.sun.management.jmxremote.port=<span class="tag">&lt;<span class="name">port</span>&gt;</span> -Dcom.sun.management.jmxremote.ssl=false</span><br><span class="line">-Dcom.sun.management.jmxremote.authenticate=false -Djava.rmi.server.hostname=<span class="tag">&lt;<span class="name">hostname</span>&gt;</span>  </span><br><span class="line">-Dcom.sun.management.jmxremote.ssl=false"</span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">详细参考：</span><br><span class="line">&gt; [使用Java自带的VisualVM监控远程主机JVM内存使用情况](http://www.cnblogs.com/chenying99/archive/2012/06/21/2557208.html "使用Java自带的VisualVM监控远程主机JVM内存使用情况")</span><br><span class="line"></span><br><span class="line">##使用resin</span><br><span class="line">在resin.conf配置文件中添加如下配置：</span><br><span class="line">```xml</span><br><span class="line"><span class="tag">&lt;<span class="name">jvm-arg</span>&gt;</span>-Xdebug<span class="tag">&lt;/<span class="name">jvm-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jvm-arg</span>&gt;</span>-Dcom.sun.management.jmxremote<span class="tag">&lt;/<span class="name">jvm-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jvm-arg</span>&gt;</span>-Djava.rmi.server.hostname=192.168.75.34<span class="tag">&lt;/<span class="name">jvm-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jvm-arg</span>&gt;</span>-Dcom.sun.management.jmxremote.port=9934<span class="tag">&lt;/<span class="name">jvm-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jvm-arg</span>&gt;</span>-Dcom.sun.management.jmxremote.ssl=false<span class="tag">&lt;/<span class="name">jvm-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jvm-arg</span>&gt;</span>-Dcom.sun.management.jmxremote.authenticate=false<span class="tag">&lt;/<span class="name">jvm-arg</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在客户端使用JMX连接即可</p>

      
    </div>
    <footer class="article-footer">
        <div class="article-meta pull-left">
          
  

  <span class="post-categories">
    <i class="icon-categories"></i>
    <a href="/categories/Java/">Java</a>
  </span>


          
  

  <span class="post-tags">
    <i class="icon-tags"></i>
    <a href="/tags/JVM/">JVM</a>, <a href="/tags/JDK/">JDK</a>
  </span>


        </div>
        
    </footer>
  </div>
</article>



  <article class="post article">

  
  
    <h3 class="article-title"><a href="/Java/2015030901_为什么不建议调用sun包，如何通过其他方法确定调用者/"><span>为什么不建议调用sun包，如何通过其他方法确定调用者</span></a></h3>
  


  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/Java/2015030901_为什么不建议调用sun包，如何通过其他方法确定调用者/" rel="bookmark">
        <time class="entry-date published" datetime="2016-02-02T06:33:13.000Z">
          2016-02-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <blockquote>
<p>Author: ChinSyun Pang<br>Weibo: <a href="http://weibo.com/arthinkingplus" target="_blank" rel="external">arthinking_plus</a><br>Posted in: <a href="http://www.itzhai.com" target="_blank" rel="external">http://www.itzhai.com</a></p>
</blockquote>
<p>#获取调用者信息的方法</p>
<p>一般的，我们可以通过堆栈信息获取调用当前方法的类名和方法名<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过堆栈信息获取调用当前方法的类名和方法名</span></span><br><span class="line">String className = <span class="string">""</span>;</span><br><span class="line">String methodName = <span class="string">""</span>;</span><br><span class="line">Class clazz = <span class="keyword">null</span>;</span><br><span class="line">StackTraceElement[] elements = <span class="keyword">new</span> Throwable().getStackTrace();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; elements.length; i++)&#123;</span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">this</span>.getClass().getName().equals(elements[i].getClassName()))&#123;</span><br><span class="line">      <span class="comment">// 获取堆栈的下一个元素，就是调用者元素</span></span><br><span class="line">      <span class="comment">// 如果想要获取当前方法所在类的信息，直接读取elements[i]就可以了</span></span><br><span class="line">      className = elements[i + <span class="number">1</span>].getClassName();</span><br><span class="line">      methodName = elements[i + <span class="number">1</span>].getMethodName();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(className + <span class="string">"."</span> + methodName + <span class="string">"\n"</span>);</span><br></pre></td></tr></table></figure></p>
<p>该方法也可以获取调用代码所在的行号的类所在的文件，但是这种方法不能获得调用者的类型，因为不知道调用者的的类装载器，所以也就不能使用Class.forName(String)得到类型。</p>
<p>可以尝试使用以下方法获得调用者的类型（但该方法不建议使用，后面有说明）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">clazz = Reflection.getCallerClass(<span class="number">2</span>);</span><br><span class="line">System.out.println(<span class="string">"invoker's class loader: "</span> + clazz.getClassLoader() + <span class="string">"\nclass name: "</span> + clazz.getName());</span><br></pre></td></tr></table></figure>
<p>该方法比使用堆栈的效率高，如果想要获取当前方法所在类的信息，调用 Reflection.getCallerClass(1) 就可以了，Reflection.getCallerClass(0) 是Reflection对象</p>
<p>#为什么不建议调用sun包</p>
<p>这篇文章中提到了JDK 8弃用 sun.reflect.Reflection.getCallerClass：</p>
<blockquote>
<p><a href="http://www.infoq.com/cn/news/2013/07/Oracle-Removes-getCallerClass" target="_blank" rel="external">http://www.infoq.com/cn/news/2013/07/Oracle-Removes-getCallerClass</a></p>
</blockquote>
<p>但后来又决定保留下来了：</p>
<blockquote>
<p><a href="http://www.infoq.com/cn/news/2013/08/Oracle-Resurrects-getCallerClass" target="_blank" rel="external">http://www.infoq.com/cn/news/2013/08/Oracle-Resurrects-getCallerClass</a></p>
</blockquote>
<p>JDK 8 实际上新特性如下</p>
<blockquote>
<p><a href="http://www.iteye.com/news/28870-java-8-release" target="_blank" rel="external">http://www.iteye.com/news/28870-java-8-release</a></p>
</blockquote>
<p>其中 JEP 176：自动检测识别Caller-Sensitive方法：</p>
<blockquote>
<p><a href="http://openjdk.java.net/jeps/176" target="_blank" rel="external">http://openjdk.java.net/jeps/176</a></p>
</blockquote>
<p>JDK 8中在getCallerClass方法加了 @sun.reflect.CallerSensitive 注解，该注解是提供给JVM底层读取处理的，提高了JDK实现感知调用者功能的安全性，详细参考：</p>
<blockquote>
<p><a href="http://stackoverflow.com/questions/22626808/what-does-the-sun-reflect-callersensitive-annotation-mean" target="_blank" rel="external">http://stackoverflow.com/questions/22626808/what-does-the-sun-reflect-callersensitive-annotation-mean</a></p>
</blockquote>
<p>查看getCallerClass的<a href="http://cr.openjdk.java.net/~mchung/jdk8/webrevs/8025799/hotspot.00/src/share/vm/prims/jvm.cpp.html" title="底层实现" target="_blank" rel="external">底层实现</a>#668可以发现，当传入了depth的时候，调用了net.reflect.Reflection类的这个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@java</span>.lang.Deprecated</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> java.lang.<span class="function">Class <span class="title">getCallerClass</span><span class="params">(<span class="keyword">int</span> arg0)</span></span>;</span><br></pre></td></tr></table></figure>
<p>这个方法在底层实现中还是通过兼容旧版本的代码去执行的，所以这个方法加了一个 @Deprecated 注解，这也是为什么不推荐上面那种方法获取调用者类型的原因。</p>
<p>类似的， JDK8 中的 @java.lang.Class 的 forName(className) 方法也加了这个注解，因为forName方法里面也调用给到了Reflection.getCallerClass()</p>
<p>Oracle建议开发人员不要使用sun包，但是有一系列的项目都依赖于getCallerClass()方法，如Jigsaw和Lambda，Intellij IDEA。在spring-loaded的<a href="https://github.com/spring-projects/spring-loaded/blob/master/springloaded/src/main/java/org/springsource/loaded/ri/ReflectiveInterceptor.java#L213" title="源码" target="_blank" rel="external">源码</a>，这里也调用了getCallerClass()方法，作为临时的方案去兼容JDK 7u25，需要添加系统属性：jdk.reflect.allowGetCallerClass，参考这里：</p>
<blockquote>
<p><a href="http://permalink.gmane.org/gmane.comp.java.openjdk.jdk7u.devel/6573" target="_blank" rel="external">http://permalink.gmane.org/gmane.comp.java.openjdk.jdk7u.devel/6573</a></p>
</blockquote>
<p>其实查看JDK 7 Reflection的字节码可以发现对这个属性的处理逻辑：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public static java.lang.Class getCallerClass(int arg0);</span><br><span class="line">     0  invokestatic sun.misc.VM.allowGetCallerClass() : boolean [216]</span><br><span class="line">     3  ifeq 13</span><br><span class="line">     6  iload_0 [arg0]</span><br><span class="line">     7  iconst_1</span><br><span class="line">     8  iadd</span><br><span class="line">     9  invokestatic sun.reflect.Reflection.getCallerClass0(int) : java.lang.Class [217]</span><br><span class="line">    12  areturn</span><br><span class="line">    13  new java.lang.UnsupportedOperationException [112]</span><br><span class="line">    16  dup</span><br><span class="line">    17  ldc &lt;String &quot;This method has been disabled by a system property&quot;&gt; [7]</span><br><span class="line">    19  invokespecial java.lang.UnsupportedOperationException(java.lang.String) [206]</span><br><span class="line">    22  athrow</span><br><span class="line">      Line numbers:</span><br><span class="line">        [pc: 0, line: 68]</span><br><span class="line">        [pc: 6, line: 69]</span><br><span class="line">        [pc: 13, line: 71]</span><br><span class="line">      Stack map table: number of frames 1</span><br><span class="line">        [pc: 13, same]</span><br></pre></td></tr></table></figure></p>
<p>开发者不应该调用sun包，Oracle一直在提醒开发者，调用sun.*包里面的方法是危险的。上面用到的Reflection.getCallerClass()也是在这个包里面的，因为sun包并不包含在Java平台的标准中，它与操作系统相关，在不同的操作系统如Solaris，Windows，Linux，Mac等中的实现也各不相同，并且可能随着JDK版本而变化。详细说明: </p>
<blockquote>
<p><a href="http://www.oracle.com/technetwork/java/faq-sun-packages-142232.html" target="_blank" rel="external">http://www.oracle.com/technetwork/java/faq-sun-packages-142232.html</a></p>
</blockquote>
<p>完整例子：</p>
<blockquote>
<p><a href="https://github.com/arthinking/java-code/blob/master/src/main/java/me/arthinking/question/Q_07_stack_trace.java" target="_blank" rel="external">https://github.com/arthinking/java-code/blob/master/src/main/java/me/arthinking/question/Q_07_stack_trace.java</a></p>
</blockquote>
<p>发表于：</p>
<blockquote>
<p><a href="http://www.itzhai.com/get-invoker-by-stacktrace-and-getcallerclass.html" target="_blank" rel="external">http://www.itzhai.com/get-invoker-by-stacktrace-and-getcallerclass.html</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
        <div class="article-meta pull-left">
          
  

  <span class="post-categories">
    <i class="icon-categories"></i>
    <a href="/categories/Java/">Java</a>
  </span>


          
  

  <span class="post-tags">
    <i class="icon-tags"></i>
    <a href="/tags/Refection/">Refection</a>
  </span>


        </div>
        
    </footer>
  </div>
</article>



  <article class="post article">

  
  
    <h3 class="article-title"><a href="/Java/2014120801_JVM笔记 - 高效并发（线程安全与锁优化）/"><span>JVM笔记 - 高效并发（线程安全与锁优化）</span></a></h3>
  


  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/Java/2014120801_JVM笔记 - 高效并发（线程安全与锁优化）/" rel="bookmark">
        <time class="entry-date published" datetime="2016-02-02T06:33:13.000Z">
          2016-02-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <blockquote>
<p>Author: ChinSyun Pang<br>Weibo: <a href="http://weibo.com/arthinkingplus" target="_blank" rel="external">arthinking_plus</a><br>Posted in: <a href="http://www.itzhai.com" target="_blank" rel="external">http://www.itzhai.com</a></p>
</blockquote>
<p>#1、概述</p>
<p>#2、线程安全</p>
<p>##2.1、Java语言中的线程安全<br>按照线程安全的“安全程度”由强至弱来排序，我们可以将Java语言中各种操作共享的数据分为以下5类：不可变、绝对线程安全、相对线程安全、线程建荣和线程对立。</p>
<p>###不可变</p>
<p>不可变的对象一定是线程安全的。</p>
<p>保证对象行为不影响自己状态的途径有很多种，其中最简单的就是把对象中带有状态的变量都声明为final。</p>
<p>Java API中符合不可变要求的类型：String，java.lang.Number的部分子类（如Long和Double的数值包装类，BigInteger和BigDecimal等大数据类型但<code>AtomicInteger</code>和<code>AtomicLong</code>则并非不可变的）。</p>
<p>###绝对线程安全<br>Java API中标注自己是线程安全的类，大多数都不是绝对线程安全的。</p>
<p>###相对线程安全<br>Java语言中，大部分的线程安全都属于这种类型，例如Vector，HashTable，Collections的synchronizedCollection()方法包装的集合等。</p>
<p>###线程兼容<br>指通过使用同步手段来保证对象在并发环境中可以安全的使用。Java API中大部分的类都是属于线程兼容的，如ArrayList和HashMap。</p>
<p>###线程对立<br>指无论调用端是否采取了同步措施，都无法在多线程环境中并发使用的代码。</p>
<p>一个线程对立的例子就是Thread类的suspend()和resumn()方法（已被JDK声明废弃了）。</p>
<p>常见的线程对立操作还有System.setIn(), System.setOut(), System.runFinalizersOnExit()…</p>
<p>##2.2、线程安全的实现方法</p>
<p>###互斥同步<br>Java中，最基本的互斥同步手段就是synchronized关键字。</p>
<p>synchronized是一个重量级的操作，因为：Java的线程是映射到操作系统的原生线程之上的，如果要阻塞或唤醒一个线程，都需要操作系统来帮忙完成，这就需要从用户态转换到核心态中，因此状态转换需要消耗很多的处理器时间。对于代码简单的同步块（如synchronized修饰的getter()和setter方法），状态转换消耗的时间有可能比用户代码执行的时间还要长。</p>
<p>还可以使用java.util.concurrent包中的<code>ReentrantLock(重入锁)</code>来实现同步：JDK1.5多线程环境下synchronized的吞吐量下降的很严重，而ReentrantLock则基本保持在同一个比较稳定的水平上。JDK 1.6之后两者性能基本持平。</p>
<p>虚拟机在未来的性能改进中还会更偏向于原生的synchronize的，所以还是<br>提倡在synchronized能实现需求的情况下，优先考虑使用synchronized来进行同步。</p>
<p>###非阻塞同步<br>非阻塞同步：从处理问题的方式上说，互斥同步属于一种悲观的并发策略。随着硬件指令集的发展，我们可以采用基于冲突检查的乐观并发策略，通俗地说，就是先行操作，如果没有其他线程争用共享数据，那操作就成功了；如果共享数据有争用，产生了冲突，那就再采取其他的补偿措施（最常见的补偿措施就是不断地重试，直到成功为止），这种乐观的并发策略的许多实现偶读不需要把线程挂起，因此这话总同步操作称为非阻塞同步。</p>
<p>###无同步方案<br>如果一个方法本来就不设计共享数据，那它自然就无须任何同步措施去保证正确性，因此会有一些代码天生就是线程安全的。这类代码包括：可重入代码和线程本地存储。</p>
<p>#3、锁优化<br>为了进一步改进高效并发，HotSpot虚拟机开发团队在JDK1.6版本上花费了大量精力实现各种锁优化。</p>
<p>##3.1、自旋锁与自适应自旋<br>为了让线程等待，我们只需要让线程执行一个忙循环（自旋），这项技术就是所谓的自旋锁。引入自旋锁的原因是互斥同步对性能最大的影响是阻塞的实现，管钱线程和恢复线程的操作都需要转入内核态中完成，给并发带来很大压力。自旋锁让物理机器有一个以上的处理器的时候，能让两个或以上的线程同时并行执行。</p>
<p>##3.2、锁消除<br>消除锁是指虚拟机即时编译器在运行时，对一些代码上要求同步，但是被检测到不可能存在共享数据竞争的锁进行消除。</p>
<p>##3.3、锁粗化<br>如果一系列的连续操作都对同一个对象反复加锁和解锁，甚至加锁操作是出现在循环体中的，则可以进行锁粗化的优化。</p>
<p>##3.4、轻量级锁<br>它的本意是在没有多线程竞争的前提下，减少传统的重量级锁使用操作系统互斥量产生的性能消耗。</p>
<p>但是如果存在锁竞争，除了互斥量的开销，还发生了CAS操作，因此在有竞争的情况下，轻量级锁会比传统的重量级锁更慢。</p>
<p>##3.5、偏向锁<br>如果说轻量级锁是在无竞争的情况下使用了CAS操作去消除同步使用的互斥量，那偏向锁就是在无竞争的情况下把整个同步都消除掉了，连CAS操作都不做了。</p>
<p>#4、本章小结</p>

      
    </div>
    <footer class="article-footer">
        <div class="article-meta pull-left">
          
  

  <span class="post-categories">
    <i class="icon-categories"></i>
    <a href="/categories/JVM/">JVM</a>
  </span>


          
        </div>
        
    </footer>
  </div>
</article>



  <article class="post article">

  
  
    <h3 class="article-title"><a href="/cache/memcached/20141211_Memcached缓存时间比实际过期时间长的问题/"><span>Memcached缓存时间比实际过期时间长的问题</span></a></h3>
  


  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/cache/memcached/20141211_Memcached缓存时间比实际过期时间长的问题/" rel="bookmark">
        <time class="entry-date published" datetime="2016-02-02T06:33:13.000Z">
          2016-02-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <blockquote>
<p>Author: ChinSyun Pang<br>Weibo: <a href="http://weibo.com/arthinkingplus" target="_blank" rel="external">arthinking_plus</a><br>Posted in: <a href="http://www.itzhai.com" target="_blank" rel="external">http://www.itzhai.com</a></p>
</blockquote>
<p>查看<a href="https://github.com/memcached/memcached/blob/master/memcached.c" title="Memcached服务器端源码" target="_blank" rel="external">Memcached服务器端源码</a>，发现MC服务器端判断缓存的有效时间是按照如下方法的：    </p>
<p>##计算服务器启动后多少秒该key会失效</p>
<p>###1、如果是一个超过30天的时间，则认为是一个Unix时间戳：<br>失效时间 = 设置的过期时间- 设置的过期时间距离memcached服务器启动时间的秒数;</p>
<p>###2、如果是一个30天内的有效时间，则认为是一个时间长度：<br>失效时间 = 设置的过期时间长度 + current_time</p>
<blockquote>
<p>具体可以参考<a href="http://my.oschina.net/u/1255608/blog/163342" title="这里" target="_blank" rel="external">这里</a>     </p>
</blockquote>
<p>如果MC服务器启动之后，对系统时间进行了调整，那么第一种情况就会得到不准确的有效时间了</p>
<p><a href="http://www.couchbase.com/issues/browse/MB-11548" title="相关bug" target="_blank" rel="external">相关bug</a></p>

      
    </div>
    <footer class="article-footer">
        <div class="article-meta pull-left">
          
  

  <span class="post-categories">
    <i class="icon-categories"></i>
    <a href="/categories/Cache/">Cache</a>
  </span>


          
  

  <span class="post-tags">
    <i class="icon-tags"></i>
    <a href="/tags/Memcached/">Memcached</a>
  </span>


        </div>
        
    </footer>
  </div>
</article>




<nav class="pagination">
  
  <a href="/page/6/" class="pagination-prev">Prev</a>
  
  
  <a href="/page/8/" class="pagination-next">Next</a>
  
</nav>
      </main>
    </article>

    <footer id="colophon" class="site-footer" role="contentinfo"><p class="site-info">
  Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
  Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
  </br>
  
  &copy; 2016 arthinking
  
</p>
</footer>
    
  </div>
</div>
</body>
</html>
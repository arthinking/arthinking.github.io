## 18 发布与订阅

### 频道的订阅与退订

#### SUBSCRIBE

```
struct redisServce {
    dict *pubsub_channels;  // key 频道，values 客户端链表
}
```

> client-10086: SUBSCRIBE "news.sport" "news.movie"

![](https://raw.githubusercontent.com/arthinking/arthinking.github.io/blog/source/_posts/NoSQL/Redis/media/14688531872005.jpg)

#### UNSUBSCRIBE

> client-10086: UNSUBSCRIBE "news.sport" "news.movie"

![](https://raw.githubusercontent.com/arthinking/arthinking.github.io/blog/source/_posts/NoSQL/Redis/media/14688534614742.jpg)

### 模式的订阅与退订

```
struct redisServer{
    list *pubsub_patterns;  // pattern: 被订阅的模式  client: 订阅模式的客户
}
```

#### PSUBSCRIBE

> client-9: PSUBSCRIBE "news.*"

![](https://raw.githubusercontent.com/arthinking/arthinking.github.io/blog/source/_posts/NoSQL/Redis/media/14688538891462.jpg)


#### PUNSUBSCRIBE

### 发送消息

#### 将消息发送给频道订阅者

#### 将消息发送给模式订阅者

### 查看订阅信息

* PUBSUB CHANNELS [pattern]
* PUBSUB NUMSUM [channel-1 channel-2 ... channel-n]
* PUBSUB NUMPAT

* Redis订阅信息丢失问题

[Redis实现简单消息队列](http://www.jianshu.com/p/9c04890615ba)

[Jedis 与 ShardedJedis 设计](http://yychao.iteye.com/blog/1751583)

[征服 Redis + Jedis + Spring （三）—— 列表操作](http://snowolf.iteye.com/blog/1824868/)

[使用Spring Data Redis操作Redis（一）](http://aiilive.blog.51cto.com/1925756/1627455?utm_source=tuicool&utm_medium=referral)


## 19 事务

通过MULTI、EXEC、WATCH等命令来实现事务功能。

### 实现

### WATCH命令的实现

### 事务的ACID性质




